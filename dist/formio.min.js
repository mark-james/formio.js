/*! formiojs v3.0.0-alpha.11 | https://unpkg.com/formiojs@3.0.0-alpha.11/LICENSE.txt */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){(function(n,s){var i,o,a,l;
/*! Native Promise Only
    v0.8.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
/*! Native Promise Only
    v0.8.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
o="Promise",l=function(){"use strict";var e,t,r,n=Object.prototype.toString,i=void 0!==s?function(e){return s(e)}:setTimeout;try{Object.defineProperty({},"x",{}),e=function(e,t,r,n){return Object.defineProperty(e,t,{value:r,writable:!0,configurable:!1!==n})}}catch(t){e=function(e,t,r){return e[t]=r,e}}function o(e,n){r.add(e,n),t||(t=i(r.drain))}function a(e){var t,r=typeof e;return null==e||"object"!=r&&"function"!=r||(t=e.then),"function"==typeof t&&t}function l(){for(var e=0;e<this.chain.length;e++)c(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function c(e,t,r){var n,s;try{!1===t?r.reject(e.msg):(n=!0===t?e.msg:t.call(void 0,e.msg))===r.promise?r.reject(TypeError("Promise-chain cycle")):(s=a(n))?s.call(n,r.resolve,r.reject):r.resolve(n)}catch(e){r.reject(e)}}function u(e){var t=this;t.triggered||(t.triggered=!0,t.def&&(t=t.def),t.msg=e,t.state=2,t.chain.length>0&&o(l,t))}function h(e,t,r,n){for(var s=0;s<t.length;s++)!function(s){e.resolve(t[s]).then(function(e){r(s,e)},n)}(s)}function f(e){this.def=e,this.triggered=!1}function p(e){if("function"!=typeof e)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var t=new function(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}(this);this.then=function(e,r){var n={success:"function"!=typeof e||e,failure:"function"==typeof r&&r};return n.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");n.resolve=e,n.reject=t}),t.chain.push(n),0!==t.state&&o(l,t),n.promise},this.catch=function(e){return this.then(void 0,e)};try{e.call(void 0,function(e){(function e(t){var r,n=this;if(!n.triggered){n.triggered=!0,n.def&&(n=n.def);try{(r=a(t))?o(function(){var s=new f(n);try{r.call(t,function(){e.apply(s,arguments)},function(){u.apply(s,arguments)})}catch(e){u.call(s,e)}}):(n.msg=t,n.state=1,n.chain.length>0&&o(l,n))}catch(e){u.call(new f(n),e)}}}).call(t,e)},function(e){u.call(t,e)})}catch(e){u.call(t,e)}}r=function(){var e,r,n;return{add:function(t,s){n=new function(e,t){this.fn=e,this.self=t,this.next=void 0}(t,s),r?r.next=n:e=n,r=n,n=void 0},drain:function(){var n=e;for(e=r=t=void 0;n;)n.fn.call(n.self),n=n.next}}}();var d=e({},"constructor",p,!1);return p.prototype=d,e(d,"__NPO__",0,!1),e(p,"resolve",function(e){return e&&"object"==typeof e&&1===e.__NPO__?e:new this(function(t,r){if("function"!=typeof t||"function"!=typeof r)throw TypeError("Not a function");t(e)})}),e(p,"reject",function(e){return new this(function(t,r){if("function"!=typeof t||"function"!=typeof r)throw TypeError("Not a function");r(e)})}),e(p,"all",function(e){var t=this;return"[object Array]"!=n.call(e)?t.reject(TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");var s=e.length,i=Array(s),o=0;h(t,e,function(e,t){i[e]=t,++o===s&&r(i)},n)})}),e(p,"race",function(e){var t=this;return"[object Array]"!=n.call(e)?t.reject(TypeError("Not an array")):new t(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");h(t,e,function(e,t){r(t)},n)})}),p},(a=void 0!==n?n:this)[o]=a[o]||l(),void 0!==e&&e.exports?e.exports=a[o]:void 0===(i=function(){return a[o]}.call(t,r,t,e))||(e.exports=i)}).call(this,r(2),r(9).setImmediate)},function(e,t){t.defaults={},t.set=function(e,r,n){var s=n||{},i=t.defaults,o=s.expires||i.expires,a=s.domain||i.domain,l=void 0!==s.path?s.path:void 0!==i.path?i.path:"/",c=void 0!==s.secure?s.secure:i.secure,u=void 0!==s.httponly?s.httponly:i.httponly,h=void 0!==s.samesite?s.samesite:i.samesite,f=o?new Date("number"==typeof o?(new Date).getTime()+864e5*o:o):0;document.cookie=e.replace(/[^+#$&^`|]/g,encodeURIComponent).replace("(","%28").replace(")","%29")+"="+r.replace(/[^+#$&/:<-\[\]-}]/g,encodeURIComponent)+(f&&f.getTime()>=0?";expires="+f.toUTCString():"")+(a?";domain="+a:"")+(l?";path="+l:"")+(c?";secure":"")+(u?";httponly":"")+(h?";samesite="+h:"")},t.get=function(e){for(var t=document.cookie.split(";");t.length;){var r=t.pop(),n=r.indexOf("=");if(n=n<0?r.length:n,decodeURIComponent(r.slice(0,n).replace(/^\s+/,""))===e)return decodeURIComponent(r.slice(n+1))}return null},t.erase=function(e,r){t.set(e,"",{expires:-1,domain:r&&r.domain,path:r&&r.path,secure:0,httponly:0})},t.all=function(){for(var e={},t=document.cookie.split(";");t.length;){var r=t.pop(),n=r.indexOf("=");n=n<0?r.length:n,e[decodeURIComponent(r.slice(0,n).replace(/^\s+/,""))]=decodeURIComponent(r.slice(n+1))}return e}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){if(!e||"object"!=typeof e)return e;var t;if(n(e)){var s=e.length;t=Array(s);for(var i=0;i<s;i++)t[i]=e[i]}else{var o=r(e);t={};i=0;for(var a=o.length;i<a;i++){var l=o[i];t[l]=e[l]}}return t};var r=Object.keys||function(e){var t=[];for(var r in e)({}).hasOwnProperty.call(e,r)&&t.push(r);return t},n=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)}},function(e,t){var r,n,s=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,h=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=a(f);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new d(e,t)),1!==c.length||u||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(0),s=r.n(n);const i=function(){return{title:"Base64",name:"base64",uploadFile:function(e,t){const r=new FileReader;return new s.a((n,s)=>{r.onload=(r=>{const s=r.target.result;n({storage:"base64",name:t,url:s,size:e.size,type:e.type,data:s.replace(`data:${e.type};base64,`,"")})}),r.onerror=(()=>s(this)),r.readAsDataURL(e)})},downloadFile:function(e){return s.a.resolve(e)}}};i.title="Base64";var o=i;const a=function(e){return{uploadFile:function(t,r,n,i){return new s.a((s,o)=>{const a=new XMLHttpRequest;"function"==typeof i&&(a.upload.onprogress=i);const l=new FormData;l.append("name",r),l.append("dir",n),l.append("file",t),a.onerror=function(e){e.networkError=!0,o(e)},a.onload=function(){if(a.status>=200&&a.status<300){const e=JSON.parse(a.response);e.storage="dropbox",e.size=t.size,e.type=t.type,e.url=e.path_lower,s(e)}else o(a.response||"Unable to upload file")},a.onabort=function(e){o(e)},a.open("POST",`${e.formUrl}/storage/dropbox`);const c=e.getToken();c&&a.setRequestHeader("x-jwt-token",c),a.send(l)})},downloadFile:function(t){const r=e.getToken();return t.url=`${e.formUrl}/storage/dropbox?path_lower=${t.path_lower}${r?`&x-jwt-token=${r}`:""}`,s.a.resolve(t)}}};a.title="Dropbox";var l=a;const c=function(e){return{uploadFile:function(t,r,n,i){return new s.a((s,o)=>{const a=new XMLHttpRequest,l=new FormData;l.append("name",r),l.append("size",t.size),l.append("type",t.type),a.onerror=function(e){e.networkError=!0,o(e)},a.onabort=function(e){o(e)},a.onload=function(){if(a.status>=200&&a.status<300){const e=JSON.parse(a.response),l=new XMLHttpRequest;"function"==typeof i&&(l.upload.onprogress=i),e.data.fileName=r,e.data.key+=n+r;const c=new FormData;for(const t in e.data)c.append(t,e.data[t]);c.append("file",t),l.onerror=function(e){e.networkError=!0,o(e)},l.onload=function(){l.status>=200&&l.status<300?s({storage:"s3",name:r,bucket:e.bucket,key:e.data.key,url:e.url+e.data.key,acl:e.data.acl,size:t.size,type:t.type}):o(l.response||"Unable to upload file")},l.onabort=function(e){o(e)},l.open("POST",e.url),l.send(c)}else o(a.response||"Unable to sign file")},a.open("POST",`${e.formUrl}/storage/s3`),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/json; charset=UTF-8");const c=e.getToken();c&&a.setRequestHeader("x-jwt-token",c),a.send(JSON.stringify({name:r,size:t.size,type:t.type}))})},downloadFile:function(t){return"public-read"!==t.acl?e.makeRequest("file",`${e.formUrl}/storage/s3?bucket=${t.bucket}&key=${t.key}`,"GET"):s.a.resolve(t)}}};c.title="S3";var u=c;const h=function(e){return{title:"Url",name:"url",uploadFile:function(t,r,n,i,o){return new s.a((s,a)=>{const l={dir:n,name:r,file:t},c=new XMLHttpRequest;"function"==typeof i&&(c.upload.onprogress=i);const u=new FormData;for(const e in l)u.append(e,l[e]);c.onload=function(){if(c.status>=200&&c.status<300){let e={};try{e=(e="string"==typeof c.response?JSON.parse(c.response):{})&&e.data?e.data:{}}catch(t){e={}}s({storage:"url",name:r,url:`${c.responseURL}/${r}`,size:t.size,type:t.type,data:e})}else a(c.response||"Unable to upload file")},c.onerror=function(){a(c)},c.onabort=function(){a(c)},c.open("POST",o);const h=e.getToken();h&&c.setRequestHeader("x-jwt-token",h),c.send(u)})},downloadFile:function(e){return s.a.resolve(e)}}};h.title="Url";var f={base64:o,dropbox:l,s3:u,url:h};t.a={storage:f}},function(e,t,r){(function(n){var s;
/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */!function(i){var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10;function l(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==i?e.maxListeners:a,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=a}function u(e,t){var r="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(r+=" Event name: "+t+"."),void 0!==n&&n.emitWarning){var s=new Error(r);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,n.emitWarning(s)}else console.error(r),console.trace&&console.trace()}function h(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}function f(e,t,r,n){if(!r)return[];var s,i,o,a,l,c,u,h=[],p=t.length,d=t[n],m=t[n+1];if(n===p&&r._listeners){if("function"==typeof r._listeners)return e&&e.push(r._listeners),[r];for(s=0,i=r._listeners.length;s<i;s++)e&&e.push(r._listeners[s]);return[r]}if("*"===d||"**"===d||r[d]){if("*"===d){for(o in r)"_listeners"!==o&&r.hasOwnProperty(o)&&(h=h.concat(f(e,t,r[o],n+1)));return h}if("**"===d){for(o in(u=n+1===p||n+2===p&&"*"===m)&&r._listeners&&(h=h.concat(f(e,t,r,p))),r)"_listeners"!==o&&r.hasOwnProperty(o)&&("*"===o||"**"===o?(r[o]._listeners&&!u&&(h=h.concat(f(e,t,r[o],p))),h=h.concat(f(e,t,r[o],n))):h=o===m?h.concat(f(e,t,r[o],n+2)):h.concat(f(e,t,r[o],n)));return h}h=h.concat(f(e,t,r[d],n+1))}if((a=r["*"])&&f(e,t,a,n+1),l=r["**"])if(n<p)for(o in l._listeners&&f(e,t,l,p),l)"_listeners"!==o&&l.hasOwnProperty(o)&&(o===m?f(e,t,l[o],n+2):o===d?f(e,t,l[o],n+1):((c={})[o]=l[o],f(e,t,{"**":c},n+1)));else l._listeners?f(e,t,l,p):l["*"]&&l["*"]._listeners&&f(e,t,l["*"],p);return h}h.EventEmitter2=h,h.prototype.delimiter=".",h.prototype.setMaxListeners=function(e){e!==i&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},h.prototype.event="",h.prototype.once=function(e,t){return this._once(e,t,!1)},h.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},h.prototype._once=function(e,t,r){return this._many(e,1,t,r),this},h.prototype.many=function(e,t,r){return this._many(e,t,r,!1)},h.prototype.prependMany=function(e,t,r){return this._many(e,t,r,!0)},h.prototype._many=function(e,t,r,n){var s=this;if("function"!=typeof r)throw new Error("many only accepts instances of Function");function i(){return 0==--t&&s.off(e,i),r.apply(this,arguments)}return i._origin=r,this._on(e,i,n),s},h.prototype.emit=function(){this._events||l.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,r,n,s,i,o=arguments.length;if(this._all&&this._all.length){if(i=this._all.slice(),o>3)for(t=new Array(o),s=0;s<o;s++)t[s]=arguments[s];for(n=0,r=i.length;n<r;n++)switch(this.event=e,o){case 1:i[n].call(this,e);break;case 2:i[n].call(this,e,arguments[1]);break;case 3:i[n].call(this,e,arguments[1],arguments[2]);break;default:i[n].apply(this,t)}}if(this.wildcard){i=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();f.call(this,i,a,this.listenerTree,0)}else{if("function"==typeof(i=this._events[e])){switch(this.event=e,o){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];i.apply(this,t)}return!0}i&&(i=i.slice())}if(i&&i.length){if(o>3)for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];for(n=0,r=i.length;n<r;n++)switch(this.event=e,o){case 1:i[n].call(this);break;case 2:i[n].call(this,arguments[1]);break;case 3:i[n].call(this,arguments[1],arguments[2]);break;default:i[n].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},h.prototype.emitAsync=function(){this._events||l.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,r,n,s,i,o=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),s=1;s<a;s++)t[s]=arguments[s];for(n=0,r=this._all.length;n<r;n++)switch(this.event=e,a){case 1:o.push(this._all[n].call(this,e));break;case 2:o.push(this._all[n].call(this,e,arguments[1]));break;case 3:o.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[n].apply(this,t))}}if(this.wildcard){i=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();f.call(this,i,c,this.listenerTree,0)}else i=this._events[e];if("function"==typeof i)switch(this.event=e,a){case 1:o.push(i.call(this));break;case 2:o.push(i.call(this,arguments[1]));break;case 3:o.push(i.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),s=1;s<a;s++)t[s-1]=arguments[s];o.push(i.apply(this,t))}else if(i&&i.length){if(i=i.slice(),a>3)for(t=new Array(a-1),s=1;s<a;s++)t[s-1]=arguments[s];for(n=0,r=i.length;n<r;n++)switch(this.event=e,a){case 1:o.push(i[n].call(this));break;case 2:o.push(i[n].call(this,arguments[1]));break;case 3:o.push(i[n].call(this,arguments[1],arguments[2]));break;default:o.push(i[n].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},h.prototype.on=function(e,t){return this._on(e,t,!1)},h.prototype.prependListener=function(e,t){return this._on(e,t,!0)},h.prototype.onAny=function(e){return this._onAny(e,!1)},h.prototype.prependAny=function(e){return this._onAny(e,!0)},h.prototype.addListener=h.prototype.on,h.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},h.prototype._on=function(e,t,r){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||l.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(function(e,t){for(var r=0,n=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;r+1<n;r++)if("**"===e[r]&&"**"===e[r+1])return;for(var s=this.listenerTree,o=e.shift();o!==i;){if(s[o]||(s[o]={}),s=s[o],0===e.length)return s._listeners?("function"==typeof s._listeners&&(s._listeners=[s._listeners]),s._listeners.push(t),!s._listeners.warned&&this._maxListeners>0&&s._listeners.length>this._maxListeners&&(s._listeners.warned=!0,u.call(this,s._listeners.length,o))):s._listeners=t,!0;o=e.shift()}return!0}.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),r?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=t,this)},h.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,n=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();n=f.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],n.push({_listeners:r})}for(var a=0;a<n.length;a++){var l=n[a];if(r=l._listeners,o(r)){for(var c=-1,u=0,h=r.length;u<h;u++)if(r[u]===t||r[u].listener&&r[u].listener===t||r[u]._origin&&r[u]._origin===t){c=u;break}if(c<0)continue;return this.wildcard?l._listeners.splice(c,1):this._events[e].splice(c,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(t!==i){var r=Object.keys(t);for(var n in r){var s=r[n],o=t[s];o instanceof Function||"object"!=typeof o||null===o||(Object.keys(o).length>0&&e(t[s]),0===Object.keys(o).length&&delete t[s])}}}(this.listenerTree),this},h.prototype.offAny=function(e){var t,r=0,n=0;if(e&&this._all&&this._all.length>0){for(r=0,n=(t=this._all).length;r<n;r++)if(e===t[r])return t.splice(r,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(r=0,n=t.length;r<n;r++)this.emit("removeListenerAny",t[r]);this._all=[]}return this},h.prototype.removeListener=h.prototype.off,h.prototype.removeAllListeners=function(e){if(e===i)return!this._events||l.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),r=f.call(this,null,t,this.listenerTree,0),n=0;n<r.length;n++){r[n]._listeners=null}else this._events&&(this._events[e]=null);return this},h.prototype.listeners=function(e){if(this.wildcard){var t=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return f.call(this,t,r,this.listenerTree,0),t}return this._events||l.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},h.prototype.eventNames=function(){return Object.keys(this._events)},h.prototype.listenerCount=function(e){return this.listeners(e).length},h.prototype.listenersAny=function(){return this._all?this._all:[]},(s=function(){return h}.call(t,r,t,e))===i||(e.exports=s)}()}).call(this,r(4))},function(e,t){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},s=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=a(e),t=l(t);var r=this.map[e];this.map[e]=r?r+","+t:t},u.prototype.delete=function(e){delete this.map[a(e)]},u.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},u.prototype.set=function(e,t){this.map[a(e)]=l(t)},u.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),c(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),c(e)},t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},m.call(y.prototype),m.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var o=[301,302,303,307,308];g.redirect=function(e,t){if(-1===o.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},e.Headers=u,e.Request=y,e.Response=g,e.fetch=function(e,r){return new Promise(function(n,s){var i=new y(e,r),o=new XMLHttpRequest;o.onload=function(){var e,t,r={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new u,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}}),t)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var s="response"in o?o.response:o.responseText;n(new g(s,r))},o.onerror=function(){s(new TypeError("Network request failed"))},o.ontimeout=function(){s(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&t.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function f(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=f(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!s(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=f(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(e,t){var r,n,s=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),i.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function v(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}}),t}function g(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,s,i,o,a,l=1,c={},u=!1,h=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){d(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){d(e.data)},n=function(e){i.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(s=h.documentElement,n=function(e){var t=h.createElement("script");t.onreadystatechange=function(){d(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):n=function(e){setTimeout(d,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&d(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(o+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var s={callback:e,args:t};return c[l]=s,n(l),l++},f.clearImmediate=p}function p(e){delete c[e]}function d(e){if(u)setTimeout(d,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{p(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(2),r(4))},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(s.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new i(s.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(8),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(2))},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",function(){return d});var n=r(0),s=r.n(n),i=(r(7),r(6)),o=r(1),a=r.n(o),l=r(3),c=r.n(l),u=r(5);const h=e=>typeof e==typeof!0,f=e=>null===e||void 0===e,p=e=>e&&"object"==typeof e;class d{constructor(e,t={}){if(!(this instanceof d))return new d(e);if(this.base="",this.projectsUrl="",this.projectUrl="",this.projectId="",this.formUrl="",this.formsUrl="",this.formId="",this.submissionsUrl="",this.submissionUrl="",this.submissionId="",this.actionsUrl="",this.actionId="",this.actionUrl="",this.vsUrl="",this.vId="",this.vUrl="",this.query="",t.hasOwnProperty("base")?this.base=t.base:d.baseUrl?this.base=d.baseUrl:this.base=window.location.href.match(/http[s]?:\/\/api./)[0],!e)return this.projectUrl=`${this.base}/project`,this.projectsUrl=`${this.base}/project`,this.projectId=!1,void(this.query="");t.hasOwnProperty("project")&&(this.projectUrl=t.project);const r=this.projectUrl||d.projectUrl;r&&this.base===r&&(this.noProject=!0,this.projectUrl=this.base),0!==e.indexOf("http")&&0!==e.indexOf("//")&&(e=this.base+e);const n=this.getUrlParts(e);let s=[];const i=n[1]+n[2],o=(e=n.length>3?n[3]:"").split("?");o.length>1&&(e=o[0],this.query=`?${o[1]}`);const a=(t,r)=>{this[`${t}sUrl`]=`${r}/${t}`;const n=new RegExp(`/${t}/([^/]+)`);return-1!==e.search(n)&&(s=e.match(n),this[`${t}Url`]=s?r+s[0]:"",this[`${t}Id`]=s.length>1?s[1]:"",r+=s[0]),r},l=(e,t,r)=>{for(const n in e)if(e.hasOwnProperty(n)){const s=e[n];if(Array.isArray(s))l(s,t,!0);else{const e=a(s,t);t=r?t:e}}};if(this.projectUrl&&this.projectUrl!==this.base||(this.projectUrl=i),!this.noProject){if(-1!==e.search(/(^|\/)(project)($|\/)/))l(["project"],i);else if(i===this.base){if(n.length>3&&e.split("/").length>1){const t=e.split("/");t.shift(),this.projectId=t.shift(),e=`/${t.join("/")}`,this.projectUrl=`${i}/${this.projectId}`}}else n.length>2&&(n[2].split(".").length>2||i.includes("localhost"))&&(this.projectUrl=i,this.projectId=n[2].split(".")[0]);this.projectsUrl=this.projectsUrl||`${this.base}/project`}if(-1!==e.search(/(^|\/)(project|form)($|\/)/))l(["form",["submission","action","v"]],this.projectUrl);else{const t=new RegExp("/(submission|action|v)($|/.*)"),r=e.match(t);this.pathType=r&&r.length>1?r[1]:"",e=(e=e.replace(t,"")).replace(/\/$/,""),this.formsUrl=`${this.projectUrl}/form`,this.formUrl=this.projectUrl+e,this.formId=e.replace(/^\/+|\/+$/g,"");const n=["submission","action","v"];for(const t in n)if(n.hasOwnProperty(t)){const s=n[t];this[`${s}sUrl`]=`${this.projectUrl+e}/${s}`,this.pathType===s&&r.length>2&&r[2]&&(this[`${s}Id`]=r[2].replace(/^\/+|\/+$/g,""),this[`${s}Url`]=this.projectUrl+e+r[0])}}d.projectUrlSet||(d.projectUrl=this.projectUrl)}delete(e,t){const r=`${e}Url`;return this[`${e}Id`]||s.a.reject("Nothing to delete"),d.cache={},this.makeRequest(e,this[r],"delete",null,t)}index(e,t,r){const n=`${e}Url`;return(t=t||"")&&p(t)&&(t=`?${d.serialize(t.params)}`),this.makeRequest(e,this[n]+t,"get",null,r)}save(e,t,r){const n=`${e}Id`,s=`${e}Url`,i=this[n]||t._id?"put":"post";let o=this[n]?this[s]:this[`${e}sUrl`];return this[n]||!t._id||"put"!==i||o.includes(t._id)||(o+=`/${t._id}`),d.cache={},this.makeRequest(e,o+this.query,i,t,r)}load(e,t,r){const n=`${e}Id`,i=`${e}Url`;return t&&p(t)&&(t=d.serialize(t.params)),t=t?this.query?`${this.query}&${t}`:`?${t}`:this.query,this[n]?this.makeRequest(e,this[i]+t,"get",null,r):s.a.reject(`Missing ${n}`)}makeRequest(...e){return d.makeRequest(this,...e)}loadProject(e,t){return this.load("project",e,t)}saveProject(e,t){return this.save("project",e,t)}deleteProject(e){return this.delete("project",e)}static loadProjects(e,t){return p(e=e||"")&&(e=`?${d.serialize(e.params)}`),d.makeStaticRequest(`${d.baseUrl}/project${e}`,"GET",null,t)}loadForm(e,t){return this.load("form",e,t).then(r=>!r.revisions||isNaN(parseInt(this.vId))?r:"current"===r.revisions&&this.submissionId?r:(e&&p(e)&&(e=d.serialize(e.params)),e=e?this.query?`${this.query}&${e}`:`?${e}`:this.query,this.makeRequest("form",this.vUrl+e,"get",null,t).then(e=>(r.components=e.components,Object.assign({},r))).catch(()=>Object.assign({},r))))}saveForm(e,t){return this.save("form",e,t)}deleteForm(e){return this.delete("form",e)}loadForms(e,t){return this.index("forms",e,t)}loadSubmission(e,t){return this.load("submission",e,t).then(e=>(this.vId=e._fvid,this.vUrl=`${this.formUrl}/v/${this.vId}`,e))}saveSubmission(e,t){return isNaN(parseInt(this.vId))||(e._fvid=this.vId),this.save("submission",e,t)}deleteSubmission(e){return this.delete("submission",e)}loadSubmissions(e,t){return this.index("submissions",e,t)}loadAction(e,t){return this.load("action",e,t)}saveAction(e,t){return this.save("action",e,t)}deleteAction(e){return this.delete("action",e)}loadActions(e,t){return this.index("actions",e,t)}availableActions(){return this.makeRequest("availableActions",`${this.formUrl}/actions`)}actionInfo(e){return this.makeRequest("actionInfo",`${this.formUrl}/actions/${e}`)}isObjectId(e){return new RegExp("^[0-9a-fA-F]{24}$").test(e)}getProjectId(){return this.projectId?this.isObjectId(this.projectId)?s.a.resolve(this.projectId):this.loadProject().then(e=>e._id):s.a.resolve("")}getFormId(){return this.formId?this.isObjectId(this.formId)?s.a.resolve(this.formId):this.loadForm().then(e=>e._id):s.a.resolve("")}currentUser(e){return d.currentUser(this,e)}accessInfo(){return d.accessInfo(this)}getToken(){return d.getToken()}getTempToken(e,t){return d.getToken()?this.makeRequest("tempToken",`${this.projectUrl}/token`,"GET",null,{ignoreCache:!0,header:new Headers({"x-expire":e,"x-allow":t})}):s.a.reject("You must be authenticated to generate a temporary auth token.")}getDownloadUrl(e){if(!this.submissionId)return s.a.resolve("");if(!e)return this.loadForm().then(e=>e?this.getDownloadUrl(e):"");let t=`/project/${e.project}`;t+=`/form/${e._id}`,t+=`/submission/${this.submissionId}`,t+="/download";let r=this.base+t;return new s.a((e,n)=>{this.getTempToken(3600,`GET:${t}`).then(t=>{r+=`?token=${t.key}`,e(r)},()=>{e(r)}).catch(n)})}uploadFile(e,t,r,n,s,i){const o={provider:e,method:"upload",file:t,fileName:r,dir:n},a=d.pluginWait("preRequest",o).then(()=>d.pluginGet("fileRequest",o).then(o=>{if(e&&f(o)){if(d.providers.storage.hasOwnProperty(e)){return new d.providers.storage[e](this).uploadFile(t,r,n,s,i)}throw"Storage provider not found"}return o||{url:""}}));return d.pluginAlter("wrapFileRequestPromise",a,o)}downloadFile(e){const t={method:"download",file:e},r=d.pluginWait("preRequest",t).then(()=>d.pluginGet("fileRequest",t).then(t=>{if(e.storage&&f(t)){if(d.providers.storage.hasOwnProperty(e.storage)){return new d.providers.storage[e.storage](this).downloadFile(e)}throw"Storage provider not found"}return t||{url:""}}));return d.pluginAlter("wrapFileRequestPromise",r,t)}canSubmit(){return s.a.all([this.loadForm(),this.currentUser(),this.accessInfo()]).then(e=>{const t=e.shift(),r=e.shift(),n=e.shift();let s={},i={};for(const e in n.roles)if(n.roles.hasOwnProperty(e)){const t=n.roles[e];t.default&&(s=t),t.admin&&(i=t)}let o=!1,a=!1;if(r&&r.roles.includes(i._id))return!0;for(const e in t.submissionAccess)if(t.submissionAccess.hasOwnProperty(e)){const n=t.submissionAccess[e];if("create_all"===n.type||"create_own"===n.type){for(const e in n.roles)if(n.roles.hasOwnProperty(e)&&(s._id===n.roles[e]&&(a=!0),r&&r.roles.includes(n.roles[e]))){o=!0;break}if(o)break}}return!o&&a&&(o=!0,d.setUser(null)),o})}getUrlParts(e){return d.getUrlParts(e,this)}static getUrlParts(e,t){const r=t&&t.base?t.base:d.baseUrl;let n="^(http[s]?:\\/\\/)";return r&&0===e.indexOf(r)?n+=`(${r.replace(/^http[s]?:\/\//,"")})`:n+="([^/]+)",n+="($|\\/.*)",e.match(new RegExp(n))}static serialize(e){const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`);return t.join("&")}static getRequestArgs(e,t,r,n,s,i){n=(n||"GET").toUpperCase(),i&&p(i)||(i={});const o={url:r,method:n,data:s||null,opts:i};return t&&(o.type=t),e&&(o.formio=e),o}static makeStaticRequest(e,t,r,n){const s=d.getRequestArgs(null,"",e,t,r,n),i=d.pluginWait("preRequest",s).then(()=>d.pluginGet("staticRequest",s).then(r=>f(r)?d.request(e,t,s.data,s.opts.header,s.opts):r));return d.pluginAlter("wrapStaticRequestPromise",i,s)}static makeRequest(e,t,r,n,s,i){if(!e)return d.makeStaticRequest(r,n,s,i);const o=d.getRequestArgs(e,t,r,n,s,i),a=d.pluginWait("preRequest",o).then(()=>d.pluginGet("request",o).then(e=>f(e)?d.request(r,n,o.data,o.opts.header,o.opts):e));return d.pluginAlter("wrapRequestPromise",a,o)}static request(e,t,r,n,i){if(!e)return s.a.reject("No url provided");t=(t||"GET").toUpperCase(),h(i)&&(i={ignoreCache:i}),i&&p(i)||(i={});const o=btoa(e);if(!i.ignoreCache&&"GET"===t&&d.cache.hasOwnProperty(o))return s.a.resolve(d.cache[o]);const a=n||new Headers(i.headers||{Accept:"application/json","Content-type":"application/json; charset=UTF-8"}),l=d.getToken();l&&!i.noToken&&a.append("x-jwt-token",l);let u={method:t,headers:a,mode:"cors"};r&&(u.body=JSON.stringify(r));const f=(u=d.pluginAlter("requestOptions",u,e)).headers.get("x-jwt-token");return fetch(e,u).then(r=>{if(!(r=d.pluginAlter("requestResponse",r,d)).ok)return 440===r.status?(d.setToken(null),d.events.emit("formio.sessionExpired",r.body)):401===r.status&&d.events.emit("formio.unauthorized",r.body),(r.headers.get("content-type").includes("application/json")?r.json():r.text()).then(e=>s.a.reject(e));const n=r.headers.get("x-jwt-token");let o=!1;if("GET"!==t||f||!n||e.includes("token=")||e.includes("x-jwt-token=")||(console.warn("Token was introduced in request."),o=!0),r.status>=200&&r.status<300&&n&&""!==n&&!o&&d.setToken(n),204===r.status)return{};return(r.headers.get("content-type").includes("application/json")?r.json():r.text()).then(e=>{let t=r.headers.get("content-range");if(t&&p(e)){if("*"!==(t=t.split("/"))[0]){const r=t[0].split("-");e.skip=Number(r[0]),e.limit=r[1]-r[0]+1}e.serverCount="*"===t[1]?t[1]:Number(t[1])}if(!i.getHeaders)return e;const n={};return r.headers.forEach((e,t)=>{n[t]=e}),{result:e,headers:n}})}).then(e=>{if(i.getHeaders)return e;let r={};return Array.isArray(e)?((r=e.map(c.a)).skip=e.skip,r.limit=e.limit,r.serverCount=e.serverCount):r=c()(e),"GET"===t&&(d.cache[o]=r),r}).catch(e=>("Bad Token"===e&&(d.setToken(null),d.events.emit("formio.badToken",e)),e.message&&(e.message=`Could not connect to API server (${e.message})`,e.networkError=!0),s.a.reject(e)))}static setToken(e){if((e=e||"")!==this.token){if(this.token=e,!e){d.setUser(null);try{return localStorage.removeItem("formioToken")}catch(e){return a.a.erase("formioToken",{path:"/"})}}try{localStorage.setItem("formioToken",e)}catch(t){a.a.set("formioToken",e,{path:"/"})}return d.currentUser()}}static getToken(){if(this.token)return this.token;try{return this.token=localStorage.getItem("formioToken")||"",this.token}catch(e){return this.token=a.a.get("formioToken"),this.token}}static setUser(e){if(!e){this.setToken(null);try{return localStorage.removeItem("formioUser")}catch(e){return a.a.erase("formioUser",{path:"/"})}}try{localStorage.setItem("formioUser",JSON.stringify(e))}catch(t){a.a.set("formioUser",JSON.stringify(e),{path:"/"})}}static getUser(){try{return JSON.parse(localStorage.getItem("formioUser")||null)}catch(e){return JSON.parse(a.a.get("formioUser"))}}static setBaseUrl(e){d.baseUrl=e,d.projectUrlSet||(d.projectUrl=e)}static getBaseUrl(){return d.baseUrl}static setApiUrl(e){return d.setBaseUrl(e)}static getApiUrl(){return d.getBaseUrl()}static setAppUrl(e){console.warn("Formio.setAppUrl() is deprecated. Use Formio.setProjectUrl instead."),d.projectUrl=e,d.projectUrlSet=!0}static setProjectUrl(e){d.projectUrl=e,d.projectUrlSet=!0}static getAppUrl(){return console.warn("Formio.getAppUrl() is deprecated. Use Formio.getProjectUrl instead."),d.projectUrl}static getProjectUrl(){return d.projectUrl}static clearCache(){d.cache={}}static noop(){}static identity(e){return e}static deregisterPlugin(e){const t=d.plugins.length;return d.plugins=d.plugins.filter(t=>t!==e&&t.__name!==e||((t.deregister||d.noop).call(e,d),!1)),t!==d.plugins.length}static registerPlugin(e,t){d.plugins.push(e),d.plugins.sort((e,t)=>(t.priority||0)-(e.priority||0)),e.__name=t,(e.init||d.noop).call(e,d)}static getPlugin(e){for(const t of d.plugins)if(t.__name===e)return t;return null}static pluginWait(e,...t){return s.a.all(d.plugins.map(r=>(r[e]||d.noop).call(r,...t)))}static pluginGet(e,...t){const r=n=>{const i=d.plugins[n];return i?s.a.resolve((i[e]||d.noop).call(i,...t)).then(e=>f(e)?r(n+1):e):s.a.resolve(null)};return r(0)}static pluginAlter(e,t,...r){return d.plugins.reduce((t,n)=>(n[e]||d.identity)(t,...r),t)}static accessInfo(e){const t=e?e.projectUrl:d.projectUrl;return d.makeRequest(e,"accessInfo",`${t}/access`)}static currentUser(e,t){let r=e?e.projectUrl:d.baseUrl;r+="/current";const n=this.getUser();return n?d.pluginAlter("wrapStaticRequestPromise",s.a.resolve(n),{url:r,method:"GET",options:t}):d.getToken()?d.makeRequest(e,"currentUser",r,"GET",null,t).then(e=>(d.setUser(e),e)):d.pluginAlter("wrapStaticRequestPromise",s.a.resolve(null),{url:r,method:"GET",options:t})}static logout(e){d.setToken(null),d.setUser(null),d.clearCache();const t=e?e.projectUrl:d.baseUrl;return d.makeRequest(e,"logout",`${t}/logout`)}}d.Headers=Headers,d.projectUrl=d.baseUrl,d.projectUrlSet=!1,d.plugins=[],d.cache={},d.providers=u.a,d.events=new i.EventEmitter2({wildcard:!1,maxListeners:0}),"object"==typeof e&&(e.Formio=d)}.call(this,r(2))}]);